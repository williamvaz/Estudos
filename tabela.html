<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b3b22" />
  <title>Estudos Futebol ‚Ä¢ Tabela</title>

  <!-- Opcional: seu CSS global -->
  <link rel="stylesheet" href="styles.css">

  <style>
    :root{
      --bg:#0b3b22;--bg2:#0e482a;--card:#113f28;--muted:#b4c8bd;--accent:#00d084;--ink:#ecf7f0;--shadow:0 8px 24px rgba(0,0,0,.25)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .app{max-width:420px;margin:0 auto;min-height:100%}

    header.topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background:rgba(0,0,0,.25);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,.08)}
    .brand{display:flex;align-items:center;gap:.5rem}
    .brand .ball{filter:drop-shadow(0 2px 4px rgba(0,0,0,.35))}
    .brand-title{font-size:1.1rem;margin:0}
    .spacer{flex:1}
    .back{border:0;background:transparent;color:var(--ink);font-size:1.25rem}

    main{padding:1rem}

    .panel{display:none}
    .panel.active{display:block}

    h2.title{margin:0 0 .75rem;font-size:1.25rem;letter-spacing:.04em}
    p.muted{margin:.25rem 0 1rem;color:var(--muted);font-size:.95rem}

    /* Grade de confedera√ß√µes/torneios */
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.75rem}
    .card{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.4rem;padding:1rem;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.08);min-height:96px}
    .card img{width:48px;height:48px;object-fit:contain}
    .card .label{font-weight:600;text-align:center}
    .card:active{transform:scale(.98)}

    /* Sele√ß√£o de grupo */
    .groups{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem}
    .pill{background:rgba(255,255,255,.08);padding:.75rem 0;border-radius:14px;text-align:center;font-weight:700;border:1px solid rgba(255,255,255,.1)}
    .pill:active{transform:scale(.98)}
    .stage-list{display:grid;gap:.5rem;margin-top:1rem}
    .stage{padding:.9rem 1rem;border-radius:14px;background:rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.1);font-weight:600;text-align:center}

    /* Grupo ‚Äì jogos e classifica√ß√£o */
    .group-header{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem}
    .badge{width:36px;height:36px;border-radius:50%;display:grid;place-items:center;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1)}

    .matches{display:grid;gap:.5rem;margin:.5rem 0 1rem}
    .match{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:.5rem;padding:.5rem .75rem;border-radius:12px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
    .team{display:flex;align-items:center;gap:.5rem;min-width:0}
    .team .flag{width:20px;height:14px;background:#234;border-radius:2px}
    .team .name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .score{font-weight:800;padding:.25rem .5rem;border-radius:8px;background:rgba(0,0,0,.3)}

    .table{width:100%;border-collapse:collapse;border-spacing:0;overflow:hidden;border-radius:14px;box-shadow:var(--shadow)}
    .table thead th{background:rgba(0,0,0,.4)}
    .table th,.table td{padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.08);text-align:center}
    .table th:first-child,.table td:first-child{text-align:left}
    .table tfoot td{background:rgba(255,255,255,.05)}

    .footer-hint{color:var(--muted);font-size:.85rem;margin-top:1rem;text-align:center}
    .ghost{opacity:.6}
  </style>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <button class="back" id="btn-back" title="Voltar" aria-label="Voltar">‚Üê</button>
      <div class="brand"><span class="ball" aria-hidden="true">‚öΩ</span>
        <h1 class="brand-title">Copa English ‚Ä¢ Tabela</h1></div>
      <div class="spacer"></div>
    </header>

    <main>
      <!-- 1) Sele√ß√£o do campeonato -->
      <section id="view-tournaments" class="panel active" aria-labelledby="tournaments-title">
        <h2 id="tournaments-title" class="title">SELECIONE O TORNEIO</h2>
        <p class="muted">Toque em um torneio para ver os grupos.</p>
        <div id="tournaments-grid" class="grid" role="list"></div>
      </section>

      <!-- 2) Sele√ß√£o do grupo -->
      <section id="view-groups" class="panel" aria-labelledby="groups-title">
        <h2 id="groups-title" class="title">SELECIONE O GRUPO</h2>
        <div class="brand ghost" id="groups-brand"></div>
        <div id="groups-grid" class="groups" role="list"></div>
        <div class="stage-list">
          <div class="stage" data-stage="oitavas">OITAVAS</div>
          <div class="stage" data-stage="quartas">QUARTAS</div>
          <div class="stage" data-stage="semi">SEMI</div>
          <div class="stage" data-stage="terceiro">3¬∫ LUGAR</div>
          <div class="stage" data-stage="final">FINAL</div>
        </div>
      </section>

      <!-- 3) Tabela e resultados do grupo -->
      <section id="view-group" class="panel" aria-labelledby="group-title">
        <div class="group-header">
          <div class="badge" id="group-conf-badge">üåç</div>
          <h2 id="group-title" class="title">GRUPO</h2>
        </div>
        <div id="matches" class="matches" aria-label="Jogos do grupo"></div>
        <h3 class="title" style="margin-top:1rem">CLASSIFICA√á√ÉO</h3>
        <div class="table-wrap">
          <table class="table" id="table-standings">
            <thead>
              <tr><th>Sele√ß√µes</th><th>JG</th><th>V</th><th>E</th><th>D</th><th>GP</th><th>GC</th><th>SG</th><th>PT</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <p class="footer-hint">Dica: use a URL com <code>#</code> para navegar ‚Äî exemplo: <code>#CopadoMundo_A</code>.</p>
      </section>
    </main>
  </div>

  <script>
  ;(() => {
    // ---------- Estado ----------
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    const views = {
      tournaments: $('#view-tournaments'),
      groups: $('#view-groups'),
      group: $('#view-group'),
    };

    let DATA = null; // campeonatos.json

    // ---------- Util: Hash Router ----------
    function parseHash(){
      const raw = (location.hash||'').replace(/^#/,'').trim();
      if(!raw) return { page:'tournaments' };
      // padr√µes:  CopaDoMundo  |  CopaDoMundo_A
      const [torneio, grupa] = raw.split('_');
      if(torneio && !grupa) return { page:'groups', torneio };
      if(torneio && grupa) return { page:'group', torneio, grupo:grupa };
      return { page:'tournaments' };
    }

    function go(hash){
      if(hash.startsWith('#')) location.hash = hash; else location.hash = '#'+hash;
    }

    function show(page){
      Object.entries(views).forEach(([k,el])=> el.classList.toggle('active', k===page));
      $('#btn-back').style.visibility = (page==='tournaments') ? 'hidden' : 'visible';
    }

    $('#btn-back').addEventListener('click', () => {
      const r = parseHash();
      if(r.page==='group') go(r.torneio);
      else go('');
    });

    window.addEventListener('hashchange', onRoute);

    async function onRoute(){
      const r = parseHash();
      if(!DATA) await ensureData();
      if(r.page==='tournaments') renderTournaments();
      if(r.page==='groups') renderGroups(r.torneio);
      if(r.page==='group') renderGroup(r.torneio, r.grupo);
      show(r.page);
    }

    // ---------- Carregar campeonatos.json ----------
    async function ensureData(){
      if(DATA) return DATA;
      try{
        const res = await fetch('campeonatos.json');
        if(!res.ok) throw new Error(res.statusText);
        DATA = await res.json();
      }catch(err){
        console.warn('Falha ao carregar campeonatos.json, usando mock m√≠nimo.', err);
        DATA = mockData();
      }
      return DATA;
    }

    // ---------- Render: Torneios ----------
    function renderTournaments(){
      const wrap = $('#tournaments-grid');
      wrap.innerHTML = '';
      const torneios = Object.keys(DATA);
      torneios.forEach(key => {
        const t = DATA[key];
        const card = document.createElement('button');
        card.className = 'card';
        card.setAttribute('role','listitem');
        card.innerHTML = `
          ${t.logo ? `<img alt="${t.nome||key}" src="${t.logo}">` : `<div class="badge">üèÜ</div>`}
          <div class="label">${t.nome || key}</div>
        `;
        card.addEventListener('click', () => go(key));
        wrap.appendChild(card);
      });
    }

    // ---------- Render: Sele√ß√£o de Grupos ----------
    function renderGroups(torneioKey){
      const t = DATA[torneioKey];
      if(!t){ go(''); return; }
      $('#groups-title').textContent = `SELECIONE O GRUPO`;
      $('#groups-brand').textContent = t.nome || torneioKey;

      const letters = Object.keys(t.grupos||{}).sort();
      const grid = $('#groups-grid');
      grid.innerHTML='';
      letters.forEach(g => {
        const b = document.createElement('button');
        b.className='pill';
        b.textContent=g;
        b.addEventListener('click', () => go(`${torneioKey}_${g}`));
        grid.appendChild(b);
      });

      // Stages (apenas navega√ß√£o visual ‚Äì pode ligar com outra p√°gina no futuro)
      $$('.stage').forEach(el => {
        el.onclick = () => alert('Em desenvolvimento: '+el.textContent+"\n(esta tela foca em Fase de Grupos)");
      });
    }

    // ---------- Render: Grupo (jogos + classifica√ß√£o) ----------
    function renderGroup(torneioKey, grupoKey){
      const t = DATA[torneioKey];
      if(!t){ go(''); return; }
      const g = (t.grupos||{})[grupoKey];
      if(!g){ go(torneioKey); return; }

      $('#group-title').textContent = `GRUPO ${grupoKey}`;
      $('#group-conf-badge').textContent = (t.emoji||'üåç');

      const teams = g.times || g.teams || [];
      // Carregar jogos: do arquivo, do localStorage, ou gerar round-robin
      let matches = (g.jogos || g.matches || null);
      if(!matches){
        matches = loadSavedMatches(torneioKey, grupoKey) || generateRoundRobin(teams);
      }

      // Render jogos
      const list = $('#matches');
      list.innerHTML='';
      matches.forEach(m => {
        const el = document.createElement('div');
        el.className = 'match';
        el.innerHTML = `
          <div class="team"><span class="flag"></span><span class="name">${safeName(m.home)}</span></div>
          <div class="score">${fmtScore(m)}</div>
          <div class="team" style="justify-self:end"><span class="name">${safeName(m.away)}</span><span class="flag"></span></div>
        `;
        list.appendChild(el);
      });

      // Classifica√ß√£o
      const tableBody = $('#table-standings tbody');
      const standings = computeTable(teams, matches);
      tableBody.innerHTML = '';
      standings.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.team}</td>
          <td>${row.PJ}</td>
          <td>${row.V}</td>
          <td>${row.E}</td>
          <td>${row.D}</td>
          <td>${row.GP}</td>
          <td>${row.GC}</td>
          <td>${row.SG}</td>
          <td><strong>${row.PTS}</strong></td>
        `;
        tableBody.appendChild(tr);
      });
    }

    // ---------- Helpers de dados ----------
    function loadSavedMatches(torneioKey, grupoKey){
      try{
        const k = `tabela:matches:${torneioKey}:${grupoKey}`;
        const raw = localStorage.getItem(k);
        if(!raw) return null;
        return JSON.parse(raw);
      }catch(e){ return null; }
    }

    function fmtScore(m){
      const a = (m.s1 ?? m.g1 ?? m.homeScore ?? '‚Äì');
      const b = (m.s2 ?? m.g2 ?? m.awayScore ?? '‚Äì');
      return `${a} : ${b}`;
    }
    function safeName(x){ return (typeof x==='string'?x:(x?.name||'‚Äî')); }

    function generateRoundRobin(teams){
      // Gera 6 partidas (grupo de 4) ‚Äì ida √∫nica
      const arr = teams.map(t => typeof t==='string'? t : t.name);
      const matches = [];
      for(let i=0;i<arr.length;i++){
        for(let j=i+1;j<arr.length;j++){
          matches.push({ home:arr[i], away:arr[j], s1:'', s2:'' });
        }
      }
      return matches;
    }

    function computeTable(teams, matches){
      const map = new Map();
      teams.forEach(t => map.set(safeName(t), {team:safeName(t), PJ:0,V:0,E:0,D:0,GP:0,GC:0,SG:0,PTS:0}));
      matches.forEach(m => {
        const h = map.get(safeName(m.home));
        const a = map.get(safeName(m.away));
        const s1 = parseInt(m.s1 ?? m.g1 ?? m.homeScore);
        const s2 = parseInt(m.s2 ?? m.g2 ?? m.awayScore);
        if(Number.isFinite(s1) && Number.isFinite(s2)){
          h.PJ++; a.PJ++;
          h.GP+=s1; h.GC+=s2; h.SG=h.GP-h.GC;
          a.GP+=s2; a.GC+=s1; a.SG=a.GP-a.GC;
          if(s1>s2){ h.V++; h.PTS+=3; a.D++; }
          else if(s1<s2){ a.V++; a.PTS+=3; h.D++; }
          else { h.E++; a.E++; h.PTS++; a.PTS++; }
        }
      });
      return Array.from(map.values()).sort((r1,r2)=>
        r2.PTS - r1.PTS || r2.SG - r1.SG || r2.GP - r1.GP || r1.team.localeCompare(r2.team)
      );
    }

    function mockData(){
      return {
        CopadoMundo:{
          nome:'Copa do Mundo (FIFA)', emoji:'üåç', logo:'',
          grupos:{
            A:{ times:['Fran√ßa','Austr√°lia','Dinamarca','Tun√≠sia'] },
            B:{ times:['Inglaterra','EUA','Ir√£','Pa√≠s de Gales'] },
            C:{ times:['Argentina','M√©xico','Pol√¥nia','Ar√°bia Saudita'] }
          }
        },
        UEFA:{
          nome:'Euro (UEFA)', emoji:'üá™üá∫',
          grupos:{ A:{ times:['Alemanha','Esc√≥cia','Hungria','Su√≠√ßa'] } }
        },
        CONMEBOL:{
          nome:'Copa Am√©rica (CONMEBOL)', emoji:'üá¶üá∑',
          grupos:{ A:{ times:['Brasil','Col√¥mbia','Paraguai','Peru'] } }
        }
      };
    }

    // Boot
    onRoute();
  })();
  </script>
</body>
</html>
