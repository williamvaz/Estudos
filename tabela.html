<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b3b22" />
  <title>Copa English ‚Ä¢ Tabela</title>
  <style>
    :root{
      --bg:#0b3b22;--bg2:#0e482a;--muted:#b4c8bd;--ink:#ecf7f0;--shadow:0 8px 24px rgba(0,0,0,.25)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--ink);
         font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .app{max-width:420px;margin:0 auto;min-height:100%;display:flex;flex-direction:column}
    header.topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:.75rem;
      padding:.75rem 1rem;background:rgba(0,0,0,.25);backdrop-filter:blur(6px);
      border-bottom:1px solid rgba(255,255,255,.08)}
    .brand{display:flex;align-items:center;gap:.5rem}
    .brand-title{font-size:1.1rem;margin:0}
    .spacer{flex:1}
    .back{border:0;background:transparent;color:var(--ink);font-size:1.25rem;cursor:pointer}
    main{padding:1rem;flex:1}
    footer{padding:.75rem 1rem;background:rgba(0,0,0,.25);border-top:1px solid rgba(255,255,255,.08)}
    footer a{color:var(--ink);text-decoration:none}

    .panel{display:none}
    .panel.active{display:block}

    h2.title{margin:0 0 .75rem;font-size:1.25rem;letter-spacing:.04em}
    p.muted{margin:.25rem 0 1rem;color:var(--muted);font-size:.95rem}

    /* Torneios */
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.75rem}
    .card{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.4rem;
      padding:1rem;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
      box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.08);min-height:104px;cursor:pointer}
    .card img{width:56px;height:56px;object-fit:contain}
    .card .label{font-weight:600;text-align:center}
    .card:active{transform:scale(.98)}

    /* Grupos */
    .groups{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem}
    .pill{background:rgba(255,255,255,.08);padding:.75rem 0;border-radius:14px;text-align:center;
      font-weight:700;border:1px solid rgba(255,255,255,.1);cursor:pointer}
    .pill:active{transform:scale(.98)}
    .brand-ghost{opacity:.7;margin-bottom:.5rem}

    /* Grupo (lista simples de times ‚Äì pode evoluir para tabela/partidas depois) */
    .team-row{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px;margin:6px 0}
    .team-row .pos{width:22px;text-align:right;font-weight:800;color:#d9ece3}
    .team-row .name{flex:1}
    .empty{color:var(--muted);font-size:.95rem}
  </style>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <button class="back" id="btn-back" title="Voltar" aria-label="Voltar">‚Üê</button>
      <div class="brand"><span aria-hidden="true">‚öΩ</span>
        <h1 class="brand-title">Copa English ‚Ä¢ Tabela</h1></div>
      <div class="spacer"></div>
    </header>

    <main>
      <!-- 1) Sele√ß√£o do campeonato -->
      <section id="view-tournaments" class="panel active" aria-labelledby="tournaments-title">
        <h2 id="tournaments-title" class="title">SELECIONE O TORNEIO</h2>
        <p class="muted">Toque em um torneio para ver os grupos.</p>
        <div id="tournaments-grid" class="grid" role="list"></div>
      </section>

      <!-- 2) Sele√ß√£o do grupo -->
      <section id="view-groups" class="panel" aria-labelledby="groups-title">
        <h2 id="groups-title" class="title">SELECIONE O GRUPO</h2>
        <div class="brand-ghost" id="groups-brand"></div>
        <div id="groups-grid" class="groups" role="list"></div>

        <div style="margin-top:1rem">
          <h2 class="title" style="font-size:1.05rem">FASES DO MATA‚ÄëMATA</h2>
          <div class="grid" style="grid-template-columns:1fr;gap:.5rem">
            <button class="pill" data-stage="oitavas">OITAVAS</button>
            <button class="pill" data-stage="quartas">QUARTAS</button>
            <button class="pill" data-stage="semi">SEMI</button>
            <button class="pill" data-stage="terceiro">3¬∫ LUGAR</button>
            <button class="pill" data-stage="final">FINAL</button>
          </div>
        </div>
      </section>

      <!-- 3) Grupo: times (simples) -->
      <section id="view-group" class="panel" aria-labelledby="group-title">
        <h2 id="group-title" class="title">GRUPO</h2>
        <div id="group-teams"></div>
      </section>
    </main>

    <footer>
      <a href="campeonato.html">‚§¥ Voltar para Campeonato</a>
    </footer>
  </div>

  <script>
  ;(() => {
    const $  = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    const views = { tournaments: $('#view-tournaments'), groups: $('#view-groups'), group: $('#view-group') };

    // Mapa de logos (usando seus arquivos em /Logos)
    const LOGOS = {
      "AFC": "Logos/AFC.png",
      "CAF": "Logos/CAF.png",
      "CONCACAF": "Logos/CONCACAF.png",
      "CONMEBOL": "Logos/CONMEBOL.svg",
      "OFC": "Logos/OFC.png",
      "UEFA": "Logos/UEFA.svg",
      "Copa das Confedera√ß√µes": "Logos/Copa das confedera√ß√µes.png",
      "Copa do Mundo": "Logos/Copa do mundo.png"
    };

    let DATA = null; // dicion√°rio { Nome: objeto }

    // ---------- Router por hash ----------
    function parseHash(){
      const raw = (location.hash||'').replace(/^#/,'').trim();
      if(!raw) return { page:'tournaments' };
      const [torneio, tail] = raw.split('_');
      if(torneio && !tail) return { page:'groups', torneio };
      if(torneio && tail && tail.startsWith('Grupo-')){
        const letra = tail.split('-')[1] || 'A';
        return { page:'group', torneio, grupo:letra };
      }
      return { page:'tournaments' };
    }
    function go(hash){ location.hash = hash.startsWith('#')? hash : '#'+hash; }
    function show(page){
      Object.entries(views).forEach(([k,el])=> el.classList.toggle('active', k===page));
      $('#btn-back').style.visibility = (page==='tournaments') ? 'hidden' : 'visible';
    }
    $('#btn-back').addEventListener('click', () => {
      const r = parseHash(); if(r.page==='group') go(r.torneio); else go('');
    });
    window.addEventListener('hashchange', onRoute);

    // ---------- Dados ----------
    function readLS(key, fb){ try{ const v = localStorage.getItem(key); return v?JSON.parse(v):fb; }catch{ return fb; } }
    function toDict(ls){
      // aceita array [{Nome:'CONMEBOL', ...}] OU objeto {CONMEBOL:{...}}
      if(!ls) return {};
      if(Array.isArray(ls)){
        const dic={}; ls.forEach(it=>{ if(it && it.Nome) dic[it.Nome]=it; });
        return dic;
      }
      return ls;
    }
    async function ensureData(){
      if(DATA) return DATA;
      const ls = readLS('campeonatos', null);
      if (ls) { DATA = toDict(ls); return DATA; }
      try{
        const res = await fetch('campeonatos.json'); if(!res.ok) throw new Error(res.statusText);
        const j = await res.json(); DATA = toDict(j);
      }catch(e){
        console.warn('Falha ao carregar campeonatos.json; usando vazio.', e);
        DATA = {};
      }
      return DATA;
    }

    // ---------- Render: Torneios ----------
    function renderTournaments(){
      const wrap = $('#tournaments-grid'); wrap.innerHTML = '';
      const nomes = Object.keys(DATA);
      if(!nomes.length){
        wrap.outerHTML = '<p class="muted">Nenhum torneio encontrado. Preencha <code>localStorage.campeonatos</code> (array com objetos contendo <b>Nome</b> e <b>Grupo 1..8</b>).</p>';
        return;
      }
      nomes.forEach(nome => {
        const logo = LOGOS[nome] || LOGOS['Copa do Mundo'] || '';
        const card = document.createElement('button');
        card.className = 'card';
        card.innerHTML = `${logo?`<img alt="${nome}" src="${logo}">`:'<div style="font-size:28px">üèÜ</div>'}
                          <div class="label">${nome}</div>`;
        card.addEventListener('click', () => go(nome)); // #CONMEBOL
        wrap.appendChild(card);
      });
    }

    // ---------- Render: Sele√ß√£o de Grupos ----------
    function renderGroups(torneioNome){
      const t = DATA[torneioNome]; if(!t){ go(''); return; }
      $('#groups-brand').textContent = torneioNome;

      // se tiver "grupos" (A,B,C...) usa; sen√£o gera pelas chaves "Grupo 1..8"
      let letters = [];
      if (t.grupos && typeof t.grupos === 'object') letters = Object.keys(t.grupos).sort();
      else {
        const nums = [];
        for (let i=1;i<=8;i++){ if (typeof t[`Grupo ${i}`] === 'number' && t[`Grupo ${i}`] > 0) nums.push(i); }
        letters = nums.map((_,idx)=> String.fromCharCode(65+idx)); // A,B,C...
      }

      const grid = $('#groups-grid'); grid.innerHTML='';
      letters.forEach(letra => {
        const b = document.createElement('button');
        b.className='pill'; b.textContent=letra;
        b.addEventListener('click', () => go(`${torneioNome}_Grupo-${letra}`));
        grid.appendChild(b);
      });

      // fases KO (placeholder ‚Äì prontos para ligar)
      $$('#view-groups [data-stage]').forEach(btn=>{
        btn.onclick = () => alert('Tela de mata-mata ainda n√£o ligada neste arquivo.');
      });
    }

    // ---------- Render: Grupo (lista simples de times) ----------
    function renderGroup(torneioNome, letra){
      const t = DATA[torneioNome]; if(!t){ go(''); return; }
      $('#group-title').textContent = `${torneioNome} ‚Ä¢ Grupo ${letra}`;
      const box = $('#group-teams'); box.innerHTML='';

      let teams = null;
      // 1) se existir t.grupos[letra] como array, usa
      if (t.grupos && Array.isArray(t.grupos[letra])) teams = t.grupos[letra];
      // 2) se existir groups_plan_v1 no LS, tenta achar
      if (!teams){
        const gp = readLS('groups_plan_v1', {});
        let bloco = gp[torneioNome];
        if(!bloco){
          const key = Object.keys(gp||{}).find(k=> k.toLowerCase().includes(String(torneioNome).toLowerCase()));
          if(key) bloco = gp[key];
        }
        if (bloco){
          const byLetter = bloco[letra] || bloco['Grupo '+letra];
          if (Array.isArray(byLetter)) teams = byLetter;
          else {
            const idx = letra.charCodeAt(0)-64; // A->1
            const byIdx = bloco['Grupo '+idx];
            if (Array.isArray(byIdx)) teams = byIdx;
          }
          if (!teams && bloco.grupos){
            teams = bloco.grupos[letra] || bloco.grupos['Grupo '+letra] || bloco.grupos['Grupo '+(letra.charCodeAt(0)-64)];
          }
        }
      }
      // 3) fallback: mostra quantidade pelo valor num√©rico do torneio ("Grupo 1..8")
      if (!teams){
        const idx = letra.charCodeAt(0)-64; // A->1
        const qtd = t['Grupo '+idx] || 0;
        if (qtd>0) teams = Array.from({length:qtd}, (_,i)=> `Time ${i+1}`);
      }

      if (!teams || !teams.length){
        box.innerHTML = '<p class="empty">N√£o encontrei os times deste grupo. Verifique <code>groups_plan_v1</code> ou adicione t.grupos["A","B",...] no objeto do torneio.</p>';
        return;
      }

      teams.forEach((nm, i) => {
        const row = document.createElement('div');
        row.className = 'team-row';
        row.innerHTML = `<div class="pos">${i+1}</div><div class="name">${typeof nm==='string'?nm:(nm?.Nome||nm?.name||'Equipe')}</div>`;
        box.appendChild(row);
      });
    }

    // ---------- Boot ----------
    async function onRoute(){
      const r = parseHash();
      if(!DATA) await ensureData();
      if(r.page==='tournaments') renderTournaments();
      if(r.page==='groups') renderGroups(r.torneio);
      if(r.page==='group') renderGroup(r.torneio, r.grupo);
      show(r.page);
    }
    onRoute();
  })();
  </script>
</body>
</html>
