<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=0.1, shrink-to-fit=yes">
  <title>Estudos Futebol ‚Ä¢ Palavras</title>
  <link rel="stylesheet" href="home.css">

  <!-- √çcones -->
  <link rel="icon" type="image/webp" href="icone.webp" />
  <link rel="apple-touch-icon" href="icone.webp" />

  <style>
    :root { color-scheme: dark; }
    body { color: #fff; }
    a { color: #fff; text-decoration: underline; }
    .container { max-width: 980px; margin: 0 auto; padding: 12px; }
    .card { background: rgba(0,0,0,.15); border: 1px solid rgba(255,255,255,.08);
            border-radius: 14px; padding: 12px; }
    .topbar .brand { display:flex; align-items:center; gap:10px; padding:12px; }
    .topbar h1 { font-size: 1.25rem; margin:0; }
    .small { font-size:.9rem; opacity:.8; }
    .muted { opacity:.85; }
    .grid { display:grid; gap:12px; }
    .header-row { display:flex; align-items:center; gap:12px; }
    .spacer { flex:1 }
    .input { width: 260px; background:#0f1f15; color:#fff; border:1px solid #284b34; border-radius:10px; padding:10px 12px; }

    /* --- stat cards --- */
    .stats { display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:10px; }
    @media (min-width: 560px) { .stats { grid-template-columns: repeat(4,minmax(0,1fr)); } }
    .stat { display:flex; flex-direction:column; gap:4px; padding:10px 12px;
            border-radius:12px; background:#102618; border:1px solid #284b34; }
    .stat-label { font-size:.85rem; opacity:.8; }
    .stat-value { font-size:1.4rem; font-weight:700; }

    /* -------- tabela responsiva sem scroll horizontal -------- */
    .table-wrap { overflow-x: visible; }

    #words-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      font-size: .95rem;
    }
    #words-table th, #words-table td {
      padding: 6px 8px;
      white-space: normal;
      word-break: break-word;
      overflow: visible;
    }
    /* Larguras */
    #words-table th:nth-child(1), #words-table td:nth-child(1) { width: 45%; } /* Word  */
    #words-table th:nth-child(2), #words-table td:nth-child(2) { width: 15%; } /* Level */
    #words-table th:nth-child(3), #words-table td:nth-child(3) { width: 20%; } /* Definition */
    #words-table th:nth-child(4), #words-table td:nth-child(4) { width: 20%; } /* Voice */

    #words-table td a {
      display:inline-block; max-width:100%;
      overflow:hidden; text-overflow:ellipsis;
      vertical-align: middle;
    }
    #words-table audio {
      display:block;
      width: 100%;
      max-width: 180px;
      height: 32px;
    }
    @media (min-width: 560px){
      #words-table audio { max-width: 220px; }
    }

    .badge { padding:2px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.15); background:rgba(255,255,255,.05); }
    .nowrap { white-space:nowrap; }

    /* Compacta√ß√£o geral no S23 */
    html { font-size: 15px; }
    @media (max-width: 390px){ html{ font-size:14px; } }
    .topbar h1 { font-size: 1.05rem; }
    .stat-value { font-size: 1.15rem; }
    .stat-label { font-size: .8rem; }
  </style>
</head>
<body class="is-mobile">
  <header class="topbar">
    <div class="brand card">
      <span style="font-size:20px">üìö</span>
      <h1>Lista de Palavras</h1>
      <a class="small" href="index.html" style="margin-left:auto">‚Üê In√≠cio</a>
    </div>
  </header>

  <main class="container grid">
    <!-- filtros -->
    <section class="card">
      <h2 style="margin:0 0 8px">Banco de palavras</h2>
      <div class="header-row" style="margin-top:8px">
        <input id="search" class="input" type="search" placeholder="Buscar palavra (ex.: house)" />
        <div class="spacer"></div>
        <span class="small muted">Mostrando palavras do arquivo <code>words.json</code></span>
      </div>
    </section>

    <!-- stats -->
    <section class="stats">
      <div class="stat">
        <div class="stat-label">Total de palavras</div>
        <div class="stat-value" id="stat-total-1plus">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">A1‚ÄìA2</div>
        <div class="stat-value" id="stat-a12">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">B1‚ÄìB2</div>
        <div class="stat-value" id="stat-b12">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">C1‚ÄìC2</div>
        <div class="stat-value" id="stat-c12">0</div>
      </div>
    </section>

    <!-- tabela -->
    <section class="card table-wrap">
      <table id="words-table">
        <thead>
          <tr>
            <th>Word</th>
            <th class="right">Level</th>
            <th>Definition</th>
            <th>Voice</th>
          </tr>
        </thead>
        <tbody id="tb"></tbody>
      </table>
    </section>
  </main>

  <script>
    // --------- config ----------
    const LKEY = 'words_info'; // { [word__pos]: { word, level, pos, definition_url, voice_url, "Memoria", "Proxima revis√£o" } }

    // --------- storage helpers ----------
    const loadStore = () => {
      try { return JSON.parse(localStorage.getItem(LKEY) || '{}'); }
      catch { return {}; }
    };
    const saveStore = (db) => localStorage.setItem(LKEY, JSON.stringify(db));

    // --------- helpers ----------
    const makeId = (w) => `${w.word}__${w.pos || ''}`;

    // Mant√©m level exatamente como veio do JSON (CEFR: a1/b2/etc.)
    function normalizeWords(raw) {
      return (raw || [])
        .map(w => ({
          word: String(w.word || '').trim(),
          level: (w.level ?? '').toString().trim(),
          pos: w.pos || '',
          definition_url: w.definition_url || '',
          voice_url: w.voice_url || ''
        }))
        .filter(w => w.word);
    }

    // Cria/atualiza o registro no localStorage com os campos solicitados
    function ensureEntry(db, w) {
      const id = makeId(w);

      if (!db[id]) {
        db[id] = {
          word: w.word,
          level: w.level,                 // CEFR como no JSON
          pos: w.pos || '',
          definition_url: w.definition_url || '',
          voice_url: w.voice_url || '',
          "Memoria": 0,                   // primeiro registro = 0
          "Proxima revis√£o": 100000       // primeiro registro = 100000
        };
      } else {
        // Sincroniza com o words.json (n√£o altera Memoria/Proxima revis√£o)
        db[id].word = w.word;
        db[id].level = w.level;
        db[id].pos = w.pos || '';
        db[id].definition_url = w.definition_url || '';
        db[id].voice_url = w.voice_url || '';
      }
    }

    // --------- estado ---------
    let DB = {};      // mapa salvo no localStorage
    let WORDS = [];   // words.json normalizado (base de render)

    // --------- UI ---------
    function renderCount() {
      const total = Object.keys(DB).length;
      const a12 = Object.values(DB).filter(x => /^a[12]$/i.test(x.level)).length;
      const b12 = Object.values(DB).filter(x => /^b[12]$/i.test(x.level)).length;
      const c12 = Object.values(DB).filter(x => /^c[12]$/i.test(x.level)).length;

      const elT = document.getElementById('stat-total-1plus');
      const elA = document.getElementById('stat-a12');
      const elB = document.getElementById('stat-b12');
      const elC = document.getElementById('stat-c12');
      if (elT) elT.textContent = String(total);
      if (elA) elA.textContent = String(a12);
      if (elB) elB.textContent = String(b12);
      if (elC) elC.textContent = String(c12);
    }

    function renderTable(filterText = '') {
      const q = (filterText || '').trim().toLowerCase();
      const tbody = document.getElementById('tb');
      if (!tbody) return;

      const rows = Object.values(DB)
        .filter(item => !q || item.word.toLowerCase().includes(q))
        .sort((a, b) => a.word.localeCompare(b.word) || (a.pos||'').localeCompare(b.pos||''))
        .map(item => {
          const def = item.definition_url ? `<a href="${item.definition_url}" target="_blank" rel="noopener">abrir</a>` : '';
          const voc = item.voice_url ? `<audio controls preload="none"><source src="${item.voice_url}"></audio>` : '';
          const badge = item.level ? item.level.toUpperCase() : '-';
          const pos = item.pos ? ` <span class="small muted">(${item.pos})</span>` : '';
          return `<tr>
            <td class="nowrap">${item.word}${pos}</td>
            <td class="right"><span class="badge">${badge}</span></td>
            <td>${def}</td>
            <td>${voc}</td>
          </tr>`;
        }).join('');

      tbody.innerHTML = rows || `<tr><td colspan="4" class="muted">Nenhuma palavra encontrada.</td></tr>`;
    }

    // --------- boot ---------
    (async function init() {
      try {
        const res = await fetch('words.json', { cache: 'no-store' });
        WORDS = res.ok ? normalizeWords(await res.json()) : [];
      } catch (e) {
        console.warn('Falha ao carregar words.json', e);
        WORDS = [];
      }

      // carrega o que j√° havia e garante as entradas m√≠nimas
      DB = loadStore();
      WORDS.forEach(w => ensureEntry(DB, w));
      saveStore(DB); // persiste ap√≥s normalizar

      // render
      renderCount();
      renderTable();

      // busca
      const search = document.getElementById('search');
      if (search) {
        search.addEventListener('input', (e) => renderTable(e.target.value));
      }
    })();
  </script>
</body>
</html>
