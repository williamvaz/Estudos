<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Copa English ‚Ä¢ Calculadora</title>
<style>
  :root{--bg:#0b3b22;--panel:#0f2f25;--ink:#e9f7f1;--muted:#9bc9ba;--acc:#1bd27a;--bad:#ff6b6b;--ok:#ffd166;}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .top{display:flex;align-items:center;gap:.75rem;padding:.9rem 1rem;background:linear-gradient(180deg,#0f3d2b,#0b3b22)}
  .top h1{font-size:1.1rem;margin:0}
  .wrap{padding:12px;display:grid;gap:12px}
  .card{background:var(--panel);border-radius:16px;padding:12px;box-shadow:0 6px 20px #0003}
  .row{display:grid;gap:8px}
  .grid{display:grid;gap:8px}
  .grid.cols-2{grid-template-columns:1fr 1fr}
  .grid.cols-3{grid-template-columns:repeat(3,1fr)}
  label{font-size:.8rem;color:var(--muted)}
  input,select,button{width:100%;padding:10px;border-radius:12px;border:1px solid #1a4a3c;background:#0c2c23;color:var(--ink)}
  button.primary{background:var(--acc);border:none;color:#062217;font-weight:700}
  .tabs{display:flex;gap:8px}
  .tab{flex:1;text-align:center;padding:10px;border-radius:12px;background:#0c2c23;border:1px solid #1a4a3c;cursor:pointer}
  .tab.active{background:#115a41}
  .hide{display:none}
  table{width:100%;border-collapse:collapse;font-size:.95rem}
  th,td{padding:8px;border-bottom:1px solid #16513f}
  th{color:#aee1cf;text-align:left}
  .badge{font-size:.7rem;padding:2px 8px;border-radius:999px;background:#0c2c23;border:1px solid #1a4a3c;color:#cfeee2}
  .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .kpi{background:#0c2c23;border:1px solid #1a4a3c;border-radius:12px;padding:10px;text-align:center}
  .kpi .v{font-size:1.1rem;font-weight:700}
  .pill{display:inline-block;padding:2px 10px;border-radius:999px;background:#124a3a;color:#cfeee2;border:1px solid #1a4a3c}
</style>
</head>
<body>
  <header class="top">
    <div style="font-size:1.3rem">üèÜ</div>
    <h1>Calculadora de Campeonato</h1>
  </header>

  <main class="wrap">
    <div class="tabs">
      <button class="tab active" data-tab="cadastro">Cadastrar Partida</button>
      <button class="tab" data-tab="grupos">Tabelas de Grupos</button>
      <button class="tab" data-tab="mata">Mata‚Äëmata</button>
      <button class="tab" data-tab="dados">Dados</button>
    </div>

    <!-- KPIs -->
    <section class="card kpis">
      <div class="kpi"><div class="t">Partidas</div><div class="v" id="kpi-games">0</div></div>
      <div class="kpi"><div class="t">Gols</div><div class="v" id="kpi-goals">0</div></div>
      <div class="kpi"><div class="t">Times</div><div class="v" id="kpi-teams">0</div></div>
    </section>

    <!-- Cadastro -->
    <section class="card" id="view-cadastro">
      <div class="grid cols-3">
        <div><label>Fase</label>
          <select id="fase">
            <option value="Grupos">Grupos</option>
            <option value="Oitavas">Oitavas</option>
            <option value="Quartas">Quartas</option>
            <option value="Semifinal">Semifinal</option>
            <option value="3¬∫ Lugar">3¬∫ Lugar</option>
            <option value="Final">Final</option>
            <option value="Outro">Outro</option>
          </select>
        </div>
        <div><label>Grupo (opcional)</label>
          <input id="grupo" placeholder="A, B, C..."/>
        </div>
        <div><label>Rodada (opcional)</label>
          <input id="rodada" type="number" min="1" placeholder="1"/>
        </div>
      </div>

      <div class="grid cols-2" style="margin-top:8px">
        <div class="row">
          <label>Time A</label>
          <input id="timeA" placeholder="ex.: Brasil"/>
        </div>
        <div class="row">
          <label>Time B</label>
          <input id="timeB" placeholder="ex.: Argentina"/>
        </div>
      </div>

      <div class="grid cols-3" style="margin-top:8px">
        <div class="row">
          <label>Gols A</label>
          <input id="golsA" type="number" min="0" value="0"/>
        </div>
        <div class="row">
          <label>Gols B</label>
          <input id="golsB" type="number" min="0" value="0"/>
        </div>
        <div class="row">
          <label>Data (opcional)</label>
          <input id="data" type="date"/>
        </div>
      </div>

      <div class="grid cols-2" style="margin-top:10px">
        <button class="primary" id="btn-add">Salvar partida</button>
        <button id="btn-clear">Limpar tudo</button>
      </div>
    </section>

    <!-- Grupos -->
    <section class="card hide" id="view-grupos">
      <div class="grid cols-3">
        <div><span class="pill">Grupo A</span></div>
        <div><span class="pill">Grupo B</span></div>
        <div><span class="pill">Grupo C</span></div>
      </div>
      <div id="grids" class="row" style="margin-top:10px"></div>
    </section>

    <!-- Mata-mata (manual por enquanto) -->
    <section class="card hide" id="view-mata">
      <p class="muted">Alimente as partidas de mata‚Äëmata na aba ‚ÄúCadastrar Partida‚Äù. Quando a fase for ‚ÄúOitavas‚Äù, ‚ÄúQuartas‚Äù, etc., elas aparecem aqui.</p>
      <div id="lista-mata"></div>
    </section>

    <!-- Dados -->
    <section class="card hide" id="view-dados">
      <div class="grid cols-2">
        <button id="btn-export">Exportar JSON</button>
        <input id="import-file" type="file" accept="application/json"/>
      </div>
      <pre id="dump" style="white-space:pre-wrap;background:#0c2c23;border:1px solid #1a4a3c;border-radius:12px;padding:10px;margin-top:8px"></pre>
    </section>
  </main>

<script>
(function(){
  const $ = s=>document.querySelector(s);
  const $$ = s=>Array.from(document.querySelectorAll(s));
  const KEY='calc_games_v1';
  let games = load();

  // Tabs
  $$('.tab').forEach(t=>{
    t.onclick = ()=>{
      $$('.tab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      const id = t.dataset.tab;
      ['cadastro','grupos','mata','dados'].forEach(v=>{
        $('#view-'+v).classList.toggle('hide', v!==id);
      });
      if(id==='grupos') renderGroups();
      if(id==='mata') renderKnockout();
      if(id==='dados') renderDump();
    };
  });

  // Bot√µes
  $('#btn-add').onclick = ()=>{
    const rec = {
      id: crypto.randomUUID(),
      fase: $('#fase').value.trim() || 'Outro',
      grupo: ($('#grupo').value||'').trim().toUpperCase(),
      rodada: Number($('#rodada').value||0),
      A: ($('#timeA').value||'').trim(),
      B: ($('#timeB').value||'').trim(),
      gA: Number($('#golsA').value||0),
      gB: Number($('#golsB').value||0),
      data: $('#data').value || null,
      ts: Date.now()
    };
    if(!rec.A || !rec.B){ alert('Informe os dois times.'); return; }
    games.push(rec);
    save(); resetForm(); updateKPIs();
  };

  $('#btn-clear').onclick = ()=>{
    if(confirm('Apagar todas as partidas?')){ games=[]; save(); updateKPIs(); renderGroups(); renderKnockout(); renderDump(); }
  };

  $('#btn-export').onclick = ()=>{
    const blob = new Blob([JSON.stringify(games,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'partidas.json';
    a.click();
  };
  $('#import-file').onchange = (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const rd = new FileReader();
    rd.onload = () => { try{ games = JSON.parse(rd.result); save(); updateKPIs(); alert('Importado!'); }catch(err){ alert('JSON inv√°lido'); } };
    rd.readAsText(f);
  };

  // Helpers persist√™ncia
  function load(){ try{ return JSON.parse(localStorage.getItem(KEY))||[] }catch{ return [] } }
  function save(){ localStorage.setItem(KEY, JSON.stringify(games)); renderGroups(); renderKnockout(); renderDump(); }
  function resetForm(){ ['timeA','timeB','golsA','golsB'].forEach(id=>{ const el=$('#'+id); el.value = (id.startsWith('gols')?0:''); }); }

  // KPIs
  function updateKPIs(){
    $('#kpi-games').textContent = games.length;
    $('#kpi-goals').textContent = games.reduce((s,g)=>s+g.gA+g.gB,0);
    const teams = new Set(); games.forEach(g=>{teams.add(g.A);teams.add(g.B);});
    $('#kpi-teams').textContent = teams.size;
  }

  // Tabelas de grupo
  function renderGroups(){
    const byGroup = {};
    games.filter(g=>g.fase==='Grupos' && g.grupo).forEach(g=>{
      byGroup[g.grupo] ??= [];
      byGroup[g.grupo].push(g);
    });
    const container = $('#grids');
    container.innerHTML = '';
    Object.keys(byGroup).sort().forEach(gr=>{
      const tbl = buildTable(byGroup[gr]);
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <strong>Grupo ${gr}</strong><span class="badge">${byGroup[gr].length} jogos</span></div>`;
      card.appendChild(tbl);
      container.appendChild(card);
    });
    updateKPIs();
  }

  function buildTable(matches){
    const stats = {};
    function team(t){ return stats[t] ??= {time:t, PJ:0,V:0,E:0,D:0,GP:0,GC:0,SG:0,PTS:0}; }
    matches.forEach(m=>{
      team(m.A); team(m.B);
      team(m.A).PJ++; team(m.B).PJ++;
      team(m.A).GP+=m.gA; team(m.A).GC+=m.gB;
      team(m.B).GP+=m.gB; team(m.B).GC+=m.gA;
      if(m.gA>m.gB){ team(m.A).V++; team(m.B).D++; team(m.A).PTS+=3; }
      else if(m.gA<m.gB){ team(m.B).V++; team(m.A).D++; team(m.B).PTS+=3; }
      else { team(m.A).E++; team(m.B).E++; team(m.A).PTS++; team(m.B).PTS++; }
    });
    Object.values(stats).forEach(s=>s.SG = s.GP - s.GC);
    const rows = Object.values(stats).sort((a,b)=>
      b.PTS - a.PTS || b.SG - a.SG || b.GP - a.GP || a.time.localeCompare(b.time)
    );
    const table = document.createElement('table');
    table.innerHTML = `<thead><tr>
      <th>#</th><th>Time</th><th>PJ</th><th>V</th><th>E</th><th>D</th><th>GP</th><th>GC</th><th>SG</th><th>PTS</th>
    </tr></thead><tbody></tbody>`;
    const tb = table.querySelector('tbody');
    rows.forEach((s,i)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${i+1}</td><td>${s.time}</td><td>${s.PJ}</td><td>${s.V}</td><td>${s.E}</td><td>${s.D}</td><td>${s.GP}</td><td>${s.GC}</td><td>${s.SG}</td><td><strong>${s.PTS}</strong></td>`;
      tb.appendChild(tr);
    });
    return table;
  }

  // Mata‚Äëmata (lista simples por fase)
  function renderKnockout(){
    const fases = ['Oitavas','Quartas','Semifinal','3¬∫ Lugar','Final','Outro'];
    const out = fases.map(f=>{
      const list = games.filter(g=>g.fase===f);
      if(!list.length) return '';
      const items = list.map(g=>`<li>${g.A} ${g.gA} √ó ${g.gB} ${g.B}${g.grupo?` <span class="badge">${g.grupo}</span>`:''}</li>`).join('');
      return `<div class="card"><strong>${f}</strong><ul>${items}</ul></div>`;
    }).join('');
    $('#lista-mata').innerHTML = out || '<p class="muted">Sem partidas de mata‚Äëmata ainda.</p>';
  }

  // Dados (debug)
  function renderDump(){ $('#dump').textContent = JSON.stringify(games, null, 2); }

  // init
  updateKPIs(); renderGroups(); renderKnockout(); renderDump();
})();
</script>
</body>
</html>
